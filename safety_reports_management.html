<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safety Reports Management - HO Safety Management</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fhosafety6270back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.9"></script>
  <script type="module" src="https://static.rocket.new/rocket-shot.js?v=0.0.1"></script>
  </head>
<body class="bg-background min-h-screen">
    <!-- Fixed Header -->
    <header class="bg-surface shadow-sm border-b border-border fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo and Title -->
                <div class="flex items-center space-x-3">
                    <div class="flex-shrink-0">
                        <svg class="h-8 w-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-semibold text-text-primary">HO Safety Management</h1>
                        <p class="text-sm text-text-secondary">Reports Management</p>
                    </div>
                </div>

                <!-- Header Actions -->
                <div class="flex items-center space-x-4">
                    <!-- Quick Actions -->
                    <div class="hidden md:flex items-center space-x-2">
                        <button onclick="showCreateReportModal()" 
                                class="btn-secondary text-sm px-3 py-2" title="Create Report (Ctrl+R)">
                            <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            New Report
                        </button>
                        <button onclick="exportReports()" 
                                class="btn-primary text-sm px-3 py-2" title="Export Reports (Ctrl+E)">
                            <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Export
                        </button>
                    </div>

                    <!-- Notifications -->
                    <div class="relative">
                        <button class="relative p-2 text-text-secondary hover:text-text-primary transition-micro rounded-lg hover:bg-gray-100">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/>
                            </svg>
                            <span class="absolute -top-1 -right-1 bg-error text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
                        </button>
                    </div>

                    <!-- User Role Indicator -->
                    <div class="flex items-center space-x-2">
                        <div class="hidden sm:block text-right">
                            <p class="text-sm font-medium text-text-primary">Sarah Johnson</p>
                            <p class="text-xs text-text-secondary">Safety Manager</p>
                        </div>
                        <img src="https://images.unsplash.com/photo-1592831383329-23d79a212006" 
                             alt="Sarah Johnson profile picture" 
                             class="h-8 w-8 rounded-full object-cover"
                             onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-16 pb-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <!-- Page Title and Stats -->
            <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-semibold text-text-primary">Safety Reports Management</h2>
                    <p class="text-text-secondary mt-1">Comprehensive incident tracking and status coordination</p>
                </div>
                <div class="flex items-center space-x-4 mt-4 sm:mt-0">
                    <div class="text-sm text-text-secondary">
                        <span class="font-medium text-text-primary" id="totalReports">149</span> total reports
                    </div>
                    <div class="flex items-center space-x-2 text-sm text-success">
                        <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                        <span>Live sync active</span>
                    </div>
                </div>
            </div>

            <!-- Desktop Layout: Sidebar + Main Content -->
            <div class="lg:grid lg:grid-cols-4 lg:gap-6">
                <!-- Filter Sidebar (Desktop) -->
                <div class="lg:col-span-1 mb-6 lg:mb-0">
                    <div class="card p-6 sticky top-20">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-text-primary">Filters</h3>
                            <button onclick="clearAllFilters()" class="text-primary hover:text-primary-700 text-sm font-medium">
                                Clear All
                            </button>
                        </div>

                        <!-- Search -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-text-primary mb-2">Search Reports</label>
                            <div class="relative">
                                <input type="text" id="searchInput" placeholder="Report ID, site, or description..." 
                                       class="w-full pl-10 pr-4 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary text-sm">
                                <svg class="absolute left-3 top-2.5 w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                </svg>
                            </div>
                        </div>

                        <!-- Site Filter -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-text-primary mb-2">Site Location</label>
                            <select id="siteFilter" class="w-full border border-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-sm">
                                <option value="">All Sites</option>
                                <option value="Site A-12">Site A-12 - Manufacturing</option>
                                <option value="Site B-07">Site B-07 - Warehouse</option>
                                <option value="Site C-03">Site C-03 - Distribution</option>
                                <option value="Site D-15">Site D-15 - Processing</option>
                                <option value="Site E-09">Site E-09 - Assembly</option>
                            </select>
                        </div>

                        <!-- Severity Filter -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-text-primary mb-2">Severity Level</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" value="Critical" class="severity-filter rounded border-border text-primary focus:ring-primary">
                                    <span class="ml-2 text-sm text-text-primary">Critical</span>
                                    <span class="ml-auto status-indicator status-error text-xs">3</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" value="High" class="severity-filter rounded border-border text-primary focus:ring-primary">
                                    <span class="ml-2 text-sm text-text-primary">High</span>
                                    <span class="ml-auto status-indicator status-warning text-xs">7</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" value="Medium" class="severity-filter rounded border-border text-primary focus:ring-primary">
                                    <span class="ml-2 text-sm text-text-primary">Medium</span>
                                    <span class="ml-auto status-indicator bg-primary-100 text-primary text-xs">12</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" value="Low" class="severity-filter rounded border-border text-primary focus:ring-primary">
                                    <span class="ml-2 text-sm text-text-primary">Low</span>
                                    <span class="ml-auto status-indicator status-success text-xs">8</span>
                                </label>
                            </div>
                        </div>

                        <!-- Status Filter -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-text-primary mb-2">Report Status</label>
                            <select id="statusFilter" class="w-full border border-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-sm">
                                <option value="">All Statuses</option>
                                <option value="Open">Open</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Under Review">Under Review</option>
                                <option value="Resolved">Resolved</option>
                                <option value="Closed">Closed</option>
                            </select>
                        </div>

                        <!-- Date Range Filter -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-text-primary mb-2">Date Range</label>
                            <div class="space-y-2">
                                <input type="date" id="startDate" class="w-full border border-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-sm">
                                <input type="date" id="endDate" class="w-full border border-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-sm">
                            </div>
                        </div>

                        <!-- Saved Filters -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-text-primary mb-2">Saved Filters</label>
                            <div class="space-y-2">
                                <button onclick="applySavedFilter('critical')" class="w-full text-left px-3 py-2 text-sm text-text-secondary hover:bg-gray-50 rounded-md transition-micro">
                                    Critical Issues Only
                                </button>
                                <button onclick="applySavedFilter('pending')" class="w-full text-left px-3 py-2 text-sm text-text-secondary hover:bg-gray-50 rounded-md transition-micro">
                                    Pending Review
                                </button>
                                <button onclick="applySavedFilter('thisWeek')" class="w-full text-left px-3 py-2 text-sm text-text-secondary hover:bg-gray-50 rounded-md transition-micro">
                                    This Week's Reports
                                </button>
                            </div>
                        </div>

                        <!-- Apply Filters Button -->
                        <button onclick="applyFilters()" class="w-full btn-primary text-sm py-2">
                            Apply Filters
                        </button>
                    </div>
                </div>

                <!-- Main Data Grid -->
                <div class="lg:col-span-3">
                    <!-- Bulk Operations Toolbar -->
                    <div id="bulkToolbar" class="card p-4 mb-4 hidden">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <span class="text-sm font-medium text-text-primary">
                                    <span id="selectedCount">0</span> reports selected
                                </span>
                                <button onclick="selectAllReports()" class="text-primary hover:text-primary-700 text-sm font-medium">
                                    Select All
                                </button>
                                <button onclick="clearSelection()" class="text-text-secondary hover:text-text-primary text-sm font-medium">
                                    Clear Selection
                                </button>
                            </div>
                            <div class="flex items-center space-x-2">
                                <select id="bulkStatusUpdate" class="border border-border rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                                    <option value="">Update Status</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Under Review">Under Review</option>
                                    <option value="Resolved">Resolved</option>
                                    <option value="Closed">Closed</option>
                                </select>
                                <button onclick="applyBulkUpdate()" class="btn-primary text-sm px-3 py-1">
                                    Apply
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Reports Table -->
                    <div class="card overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 border-b border-border">
                                    <tr>
                                        <th class="px-4 py-3 text-left">
                                            <input type="checkbox" id="selectAllCheckbox" class="rounded border-border text-primary focus:ring-primary">
                                        </th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-text-primary cursor-pointer hover:bg-gray-100" onclick="sortTable('id')">
                                            Report ID
                                            <svg class="w-4 h-4 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                                            </svg>
                                        </th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-text-primary cursor-pointer hover:bg-gray-100" onclick="sortTable('site')">
                                            Site Location
                                        </th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-text-primary cursor-pointer hover:bg-gray-100" onclick="sortTable('type')">
                                            Incident Type
                                        </th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-text-primary cursor-pointer hover:bg-gray-100" onclick="sortTable('severity')">
                                            Severity
                                        </th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-text-primary cursor-pointer hover:bg-gray-100" onclick="sortTable('status')">
                                            Status
                                        </th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-text-primary cursor-pointer hover:bg-gray-100" onclick="sortTable('supervisor')">
                                            Supervisor
                                        </th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-text-primary cursor-pointer hover:bg-gray-100" onclick="sortTable('date')">
                                            Date
                                        </th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-text-primary">
                                            Actions
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="reportsTableBody" class="divide-y divide-border">
                                    <!-- Reports will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div class="px-4 py-3 border-t border-border bg-gray-50">
                            <div class="flex items-center justify-between">
                                <div class="text-sm text-text-secondary">
                                    Showing <span id="showingStart">1</span> to <span id="showingEnd">20</span> of <span id="totalResults">149</span> results
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button onclick="previousPage()" id="prevButton" class="px-3 py-1 text-sm border border-border rounded-md hover:bg-gray-100 transition-micro">
                                        Previous
                                    </button>
                                    <div class="flex items-center space-x-1" id="pageNumbers">
                                        <!-- Page numbers will be populated by JavaScript -->
                                    </div>
                                    <button onclick="nextPage()" id="nextButton" class="px-3 py-1 text-sm border border-border rounded-md hover:bg-gray-100 transition-micro">
                                        Next
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Create Report Modal -->
    <div id="createReportModal" class="fixed inset-0 bg-black bg-opacity-50 z-60 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-surface rounded-lg shadow-modal w-full max-w-2xl max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-text-primary">Create New Safety Report</h3>
                        <button onclick="closeCreateReportModal()" class="text-text-secondary hover:text-text-primary">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>

                    <form id="createReportForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-text-primary mb-1">Site Location</label>
                                <select required class="w-full border border-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <option value="">Select Site</option>
                                    <option value="Site A-12">Site A-12 - Manufacturing</option>
                                    <option value="Site B-07">Site B-07 - Warehouse</option>
                                    <option value="Site C-03">Site C-03 - Distribution</option>
                                    <option value="Site D-15">Site D-15 - Processing</option>
                                    <option value="Site E-09">Site E-09 - Assembly</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-text-primary mb-1">Incident Type</label>
                                <select required class="w-full border border-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <option value="">Select Type</option>
                                    <option value="Equipment Malfunction">Equipment Malfunction</option>
                                    <option value="Safety Protocol Violation">Safety Protocol Violation</option>
                                    <option value="Near Miss">Near Miss</option>
                                    <option value="Injury">Injury</option>
                                    <option value="Environmental Hazard">Environmental Hazard</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-text-primary mb-1">Severity Level</label>
                                <select required class="w-full border border-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <option value="">Select Severity</option>
                                    <option value="Critical">Critical</option>
                                    <option value="High">High</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-text-primary mb-1">Assigned Supervisor</label>
                                <select required class="w-full border border-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                                    <option value="">Select Supervisor</option>
                                    <option value="Mike Chen">Mike Chen</option>
                                    <option value="Lisa Rodriguez">Lisa Rodriguez</option>
                                    <option value="David Kim">David Kim</option>
                                    <option value="Emma Thompson">Emma Thompson</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-text-primary mb-1">Description</label>
                            <textarea required rows="4" placeholder="Detailed description of the incident..." 
                                      class="w-full border border-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
                        </div>

                        <div class="flex items-center justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeCreateReportModal()" class="px-4 py-2 text-text-secondary hover:text-text-primary transition-micro">
                                Cancel
                            </button>
                            <button type="submit" class="btn-primary px-6 py-2">
                                Create Report
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Fixed Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-surface border-t border-border z-40">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-around h-16">
                <a href="ho_safety_dashboard.html" class="flex flex-col items-center space-y-1 text-text-secondary hover:text-primary transition-micro">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                    </svg>
                    <span class="text-xs font-medium">Dashboard</span>
                </a>
                <a href="safety_reports_management.html" class="flex flex-col items-center space-y-1 text-primary">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <span class="text-xs font-medium">Reports</span>
                </a>
                <a href="team_management_interface.html" class="flex flex-col items-center space-y-1 text-text-secondary hover:text-primary transition-micro">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                    <span class="text-xs font-medium">Teams</span>
                </a>
                <a href="alert_broadcasting_system.html" class="flex flex-col items-center space-y-1 text-text-secondary hover:text-primary transition-micro relative">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/>
                    </svg>
                    <span class="absolute -top-1 -right-1 bg-error text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">3</span>
                    <span class="text-xs font-medium">Alerts</span>
                </a>
                <a href="profile_management_center.html" class="flex flex-col items-center space-y-1 text-text-secondary hover:text-primary transition-micro">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    <span class="text-xs font-medium">Profile</span>
                </a>
            </div>
        </div>
    </nav>

    <script>
        // Mock data for safety reports
        const mockReports = [
            {
                id: 'SR-2024-001',
                site: 'Site A-12',
                type: 'Equipment Malfunction',
                severity: 'Critical',
                status: 'Open',
                supervisor: 'Mike Chen',
                date: '2024-10-20',
                description: 'Hydraulic system failure in main production line'
            },
            {
                id: 'SR-2024-002',
                site: 'Site B-07',
                type: 'Safety Protocol Violation',
                severity: 'High',
                status: 'In Progress',
                supervisor: 'Lisa Rodriguez',
                date: '2024-10-19',
                description: 'Worker not wearing required PPE in hazardous area'
            },
            {
                id: 'SR-2024-003',
                site: 'Site C-03',
                type: 'Near Miss',
                severity: 'Medium',
                status: 'Under Review',
                supervisor: 'David Kim',
                date: '2024-10-18',
                description: 'Forklift nearly collided with pedestrian in warehouse'
            },
            {
                id: 'SR-2024-004',
                site: 'Site D-15',
                type: 'Environmental Hazard',
                severity: 'High',
                status: 'Resolved',
                supervisor: 'Emma Thompson',
                date: '2024-10-17',
                description: 'Chemical spill contained and cleaned up'
            },
            {
                id: 'SR-2024-005',
                site: 'Site E-09',
                type: 'Injury',
                severity: 'Critical',
                status: 'Closed',
                supervisor: 'Mike Chen',
                date: '2024-10-16',
                description: 'Minor cut treated by first aid team'
            },
            {
                id: 'SR-2024-006',
                site: 'Site A-12',
                type: 'Equipment Malfunction',
                severity: 'Low',
                status: 'Open',
                supervisor: 'Lisa Rodriguez',
                date: '2024-10-15',
                description: 'Conveyor belt running slower than normal'
            },
            {
                id: 'SR-2024-007',
                site: 'Site B-07',
                type: 'Safety Protocol Violation',
                severity: 'Medium',
                status: 'In Progress',
                supervisor: 'David Kim',
                date: '2024-10-14',
                description: 'Emergency exit blocked by equipment'
            },
            {
                id: 'SR-2024-008',
                site: 'Site C-03',
                type: 'Near Miss',
                severity: 'Low',
                status: 'Resolved',
                supervisor: 'Emma Thompson',
                date: '2024-10-13',
                description: 'Slip hazard identified and marked'
            }
        ];

        let currentPage = 1;
        const itemsPerPage = 20;
        let filteredReports = [...mockReports];
        let selectedReports = new Set();

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            populateReportsTable();
            setupEventListeners();
            updatePagination();
        });

        function setupEventListeners() {
            // Search input
            document.getElementById('searchInput').addEventListener('input', debounce(applyFilters, 300));
            
            // Filter changes
            document.getElementById('siteFilter').addEventListener('change', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('startDate').addEventListener('change', applyFilters);
            document.getElementById('endDate').addEventListener('change', applyFilters);
            
            // Severity checkboxes
            document.querySelectorAll('.severity-filter').forEach(checkbox => {
                checkbox.addEventListener('change', applyFilters);
            });

            // Select all checkbox
            document.getElementById('selectAllCheckbox').addEventListener('change', function() {
                const isChecked = this.checked;
                document.querySelectorAll('.report-checkbox').forEach(checkbox => {
                    checkbox.checked = isChecked;
                    if (isChecked) {
                        selectedReports.add(checkbox.value);
                    } else {
                        selectedReports.delete(checkbox.value);
                    }
                });
                updateBulkToolbar();
            });

            // Create report form
            document.getElementById('createReportForm').addEventListener('submit', function(e) {
                e.preventDefault();
                createNewReport();
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey) {
                    switch(e.key) {
                        case 'r':
                            e.preventDefault();
                            showCreateReportModal();
                            break;
                        case 'e':
                            e.preventDefault();
                            exportReports();
                            break;
                    }
                }
            });
        }

        function populateReportsTable() {
            const tbody = document.getElementById('reportsTableBody');
            tbody.innerHTML = '';

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageReports = filteredReports.slice(startIndex, endIndex);

            pageReports.forEach(report => {
                const row = createReportRow(report);
                tbody.appendChild(row);
            });

            updatePagination();
        }

        function createReportRow(report) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 transition-micro';
            
            const severityClass = getSeverityClass(report.severity);
            const statusClass = getStatusClass(report.status);

            row.innerHTML = `
                <td class="px-4 py-3">
                    <input type="checkbox" value="${report.id}" class="report-checkbox rounded border-border text-primary focus:ring-primary">
                </td>
                <td class="px-4 py-3">
                    <span class="font-data text-sm text-text-primary">${report.id}</span>
                </td>
                <td class="px-4 py-3">
                    <span class="text-sm text-text-primary">${report.site}</span>
                </td>
                <td class="px-4 py-3">
                    <span class="text-sm text-text-primary">${report.type}</span>
                </td>
                <td class="px-4 py-3">
                    <span class="status-indicator ${severityClass} text-xs">${report.severity}</span>
                </td>
                <td class="px-4 py-3">
                    <select class="status-select text-sm border border-border rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-primary" 
                            data-report-id="${report.id}" onchange="updateReportStatus('${report.id}', this.value)">
                        <option value="Open" ${report.status === 'Open' ? 'selected' : ''}>Open</option>
                        <option value="In Progress" ${report.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                        <option value="Under Review" ${report.status === 'Under Review' ? 'selected' : ''}>Under Review</option>
                        <option value="Resolved" ${report.status === 'Resolved' ? 'selected' : ''}>Resolved</option>
                        <option value="Closed" ${report.status === 'Closed' ? 'selected' : ''}>Closed</option>
                    </select>
                </td>
                <td class="px-4 py-3">
                    <span class="text-sm text-text-primary">${report.supervisor}</span>
                </td>
                <td class="px-4 py-3">
                    <span class="text-sm text-text-secondary">${formatDate(report.date)}</span>
                </td>
                <td class="px-4 py-3">
                    <div class="flex items-center space-x-2">
                        <button onclick="viewReportDetails('${report.id}')" 
                                class="text-primary hover:text-primary-700 text-sm font-medium" title="View Details">
                            View
                        </button>
                        <button onclick="editReport('${report.id}')" 
                                class="text-secondary hover:text-secondary-700 text-sm font-medium" title="Edit Report">
                            Edit
                        </button>
                    </div>
                </td>
            `;

            // Add event listener for checkbox
            const checkbox = row.querySelector('.report-checkbox');
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    selectedReports.add(this.value);
                } else {
                    selectedReports.delete(this.value);
                }
                updateBulkToolbar();
            });

            return row;
        }

        function getSeverityClass(severity) {
            switch(severity) {
                case 'Critical': return 'status-error';
                case 'High': return 'status-warning';
                case 'Medium': return 'bg-primary-100 text-primary';
                case 'Low': return 'status-success';
                default: return 'bg-gray-100 text-gray-600';
            }
        }

        function getStatusClass(status) {
            switch(status) {
                case 'Open': return 'status-error';
                case 'In Progress': return 'status-warning';
                case 'Under Review': return 'bg-primary-100 text-primary';
                case 'Resolved': return 'status-success';
                case 'Closed': return 'bg-gray-100 text-gray-600';
                default: return 'bg-gray-100 text-gray-600';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const siteFilter = document.getElementById('siteFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            const severityFilters = Array.from(document.querySelectorAll('.severity-filter:checked'))
                .map(cb => cb.value);

            filteredReports = mockReports.filter(report => {
                // Search filter
                if (searchTerm && !report.id.toLowerCase().includes(searchTerm) && 
                    !report.site.toLowerCase().includes(searchTerm) && 
                    !report.description.toLowerCase().includes(searchTerm)) {
                    return false;
                }

                // Site filter
                if (siteFilter && report.site !== siteFilter) {
                    return false;
                }

                // Status filter
                if (statusFilter && report.status !== statusFilter) {
                    return false;
                }

                // Severity filter
                if (severityFilters.length > 0 && !severityFilters.includes(report.severity)) {
                    return false;
                }

                // Date range filter
                if (startDate && report.date < startDate) {
                    return false;
                }
                if (endDate && report.date > endDate) {
                    return false;
                }

                return true;
            });

            currentPage = 1;
            populateReportsTable();
            updateResultsCount();
        }

        function clearAllFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('siteFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            
            document.querySelectorAll('.severity-filter').forEach(cb => cb.checked = false);
            
            filteredReports = [...mockReports];
            currentPage = 1;
            populateReportsTable();
            updateResultsCount();
        }

        function applySavedFilter(filterType) {
            clearAllFilters();
            
            switch(filterType) {
                case 'critical':
                    document.querySelector('.severity-filter[value="Critical"]').checked = true;
                    break;
                case 'pending':
                    document.getElementById('statusFilter').value = 'Under Review';
                    break;
                case 'thisWeek':
                    const today = new Date();
                    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    document.getElementById('startDate').value = weekAgo.toISOString().split('T')[0];
                    document.getElementById('endDate').value = today.toISOString().split('T')[0];
                    break;
            }
            
            applyFilters();
        }

        function updateBulkToolbar() {
            const toolbar = document.getElementById('bulkToolbar');
            const selectedCount = selectedReports.size;
            
            if (selectedCount > 0) {
                toolbar.classList.remove('hidden');
                document.getElementById('selectedCount').textContent = selectedCount;
            } else {
                toolbar.classList.add('hidden');
            }
        }

        function selectAllReports() {
            document.querySelectorAll('.report-checkbox').forEach(checkbox => {
                checkbox.checked = true;
                selectedReports.add(checkbox.value);
            });
            document.getElementById('selectAllCheckbox').checked = true;
            updateBulkToolbar();
        }

        function clearSelection() {
            document.querySelectorAll('.report-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('selectAllCheckbox').checked = false;
            selectedReports.clear();
            updateBulkToolbar();
        }

        function applyBulkUpdate() {
            const newStatus = document.getElementById('bulkStatusUpdate').value;
            if (!newStatus) {
                alert('Please select a status to update.');
                return;
            }

            if (confirm(`Update ${selectedReports.size} reports to "${newStatus}"?`)) {
                selectedReports.forEach(reportId => {
                    updateReportStatus(reportId, newStatus);
                });
                
                clearSelection();
                alert(`Successfully updated ${selectedReports.size} reports.`);
            }
        }

        function updateReportStatus(reportId, newStatus) {
            const report = mockReports.find(r => r.id === reportId);
            if (report) {
                report.status = newStatus;
                populateReportsTable();
            }
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredReports.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage + 1;
            const endIndex = Math.min(currentPage * itemsPerPage, filteredReports.length);

            document.getElementById('showingStart').textContent = startIndex;
            document.getElementById('showingEnd').textContent = endIndex;
            document.getElementById('totalResults').textContent = filteredReports.length;

            // Update page numbers
            const pageNumbers = document.getElementById('pageNumbers');
            pageNumbers.innerHTML = '';

            for (let i = 1; i <= totalPages; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.className = `px-3 py-1 text-sm border border-border rounded-md transition-micro ${
                    i === currentPage ? 'bg-primary text-white border-primary' : 'hover:bg-gray-100'
                }`;
                button.onclick = () => goToPage(i);
                pageNumbers.appendChild(button);
            }

            // Update navigation buttons
            document.getElementById('prevButton').disabled = currentPage === 1;
            document.getElementById('nextButton').disabled = currentPage === totalPages;
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                populateReportsTable();
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(filteredReports.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                populateReportsTable();
            }
        }

        function goToPage(page) {
            currentPage = page;
            populateReportsTable();
        }

        function updateResultsCount() {
            document.getElementById('totalReports').textContent = filteredReports.length;
        }

        function sortTable(column) {
            // Simple sorting implementation
            filteredReports.sort((a, b) => {
                if (a[column] < b[column]) return -1;
                if (a[column] > b[column]) return 1;
                return 0;
            });
            populateReportsTable();
        }

        function showCreateReportModal() {
            document.getElementById('createReportModal').classList.remove('hidden');
        }

        function closeCreateReportModal() {
            document.getElementById('createReportModal').classList.add('hidden');
            document.getElementById('createReportForm').reset();
        }

        function createNewReport() {
            const form = document.getElementById('createReportForm');
            const formData = new FormData(form);
            
            // Generate new report ID
            const newId = `SR-2024-${String(mockReports.length + 1).padStart(3, '0')}`;
            
            const newReport = {
                id: newId,
                site: formData.get('site') || form.querySelector('select').value,
                type: formData.get('type') || form.querySelectorAll('select')[1].value,
                severity: formData.get('severity') || form.querySelectorAll('select')[2].value,
                status: 'Open',
                supervisor: formData.get('supervisor') || form.querySelectorAll('select')[3].value,
                date: new Date().toISOString().split('T')[0],
                description: formData.get('description') || form.querySelector('textarea').value
            };

            mockReports.unshift(newReport);
            filteredReports = [...mockReports];
            populateReportsTable();
            closeCreateReportModal();
            
            alert('New safety report created successfully!');
        }

        function exportReports() {
            const csvContent = generateCSV(filteredReports);
            downloadCSV(csvContent, 'safety_reports.csv');
        }

        function generateCSV(reports) {
            const headers = ['Report ID', 'Site Location', 'Incident Type', 'Severity', 'Status', 'Supervisor', 'Date', 'Description'];
            const csvRows = [headers.join(',')];

            reports.forEach(report => {
                const row = [
                    report.id,
                    report.site,
                    report.type,
                    report.severity,
                    report.status,
                    report.supervisor,
                    report.date,
                    `"${report.description}"`
                ];
                csvRows.push(row.join(','));
            });

            return csvRows.join('\n');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function viewReportDetails(reportId) {
            const report = mockReports.find(r => r.id === reportId);
            if (report) {
                alert(`Report Details:\n\nID: ${report.id}\nSite: ${report.site}\nType: ${report.type}\nSeverity: ${report.severity}\nStatus: ${report.status}\nSupervisor: ${report.supervisor}\nDate: ${report.date}\nDescription: ${report.description}`);
            }
        }

        function editReport(reportId) {
            alert(`Edit functionality for report ${reportId} would open a detailed edit modal.`);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Close modal when clicking outside
        document.getElementById('createReportModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCreateReportModal();
            }
        });
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>